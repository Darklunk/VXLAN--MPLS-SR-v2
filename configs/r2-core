! device: r2-core (cEOSLab, EOS-4.35.0F-44178984.4350F (engineering build))
!
no aaa root
!
username admin privilege 15 role network-admin secret sha512 $6$KZi5bx7gzqij9Kpi$MZ2O5TqeKfS1jSO.7J3lnkVmwNWt82sKKZ0VyW0sqP1QamwJ0GH8e5kIH/PgD90maLUs2sM1G5Zyg0XZUwgqs/
username lunkan privilege 15 role network-admin secret sha512 $6$tnHoOd3ZWokfAU6C$LsSOjZlW3jpfiENhZymMPBTRhYBgivDf5JRaxTVkyNk6WbHrwZdT/C28YtM9UEzCzr7XsN8gdhvbZK7YZ1eSw/
!
hardware counter feature mpls tunnel
!
management api http-commands
   no shutdown
!
alias ls dir
!
switchport default mode routed
!
no service interface inactive port-id allocation disabled
!
transceiver qsfp default-mode 4x10G
!
service routing protocols model multi-agent
!
hostname r2-core
!
spanning-tree mode none
!
system l1
   unsupported speed action error
   unsupported error-correction action error
!
vrf instance evpn_1
!
vrf instance evpn_2
!
management api gnmi
   transport grpc default
!
management api netconf
   transport ssh default
!
interface Port-Channel1
   shutdown
   no switchport
   bfd interval 1000 min-rx 500 multiplier 3
   bfd neighbor 2001:1:1:1::2
   bfd per-link rfc-7130
   isis enable igp
   isis bfd
   isis network point-to-point
   traffic-engineering
!
interface Ethernet1
   description r2-r3
   mtu 9000
   no switchport
   ipv6 address 2001:1:1:1::6/127
   isis enable igp
   isis network point-to-point
   traffic-engineering
!
interface Ethernet2
   description r2-r1
   mtu 9000
   no switchport
   ipv6 address 2001:1:1:1::3/127
   isis enable igp
   isis ipv6 metric 100
   isis network point-to-point
   traffic-engineering
!
interface Ethernet3
   no switchport
   ipv6 address 2001:3:3:3::2/127
!
interface Ethernet4
   no switchport
!
interface Loopback0
   ip address 112.112.112.112/32
   ipv6 address 2001:112:112:112::112/128
   node-segment ipv4 index 12
   node-segment ipv6 index 612
   isis enable igp
   isis metric 0
   isis passive
!
interface Loopback1
   vrf evpn_1
   ip address 7.7.7.7/32
   ipv6 address 2001:777::1/64
!
interface Management0
   ip address 192.168.5.112/24
!
interface Vxlan1
   vxlan source-interface Loopback0
   vxlan udp-port 4789
   vxlan encapsulation ipv6
   icmp helper vrf all
   vxlan vrf evpn_1 vni 10
   vxlan vrf evpn_2 vni 20
!
ip virtual-router mac-address aa:aa:aa:aa:aa:aa
!
ip routing ipv6 interfaces 
ip routing ipv6 interfaces  vrf evpn_1
ip routing vrf evpn_2
!
ipv6 unicast-routing
ipv6 unicast-routing vrf evpn_1
ipv6 unicast-routing vrf evpn_2
!
ip route 0.0.0.0/0 192.168.5.1
!
mpls ip
!
mpls icmp ttl-exceeded tunneling
mpls icmp ipv6 source-interface Loopback0
mpls icmp ip source-interface Loopback0
!
route-map 612 permit 10
   set extcommunity color 612 additive
!
route-map 612 permit 20
!
router bgp 65550
   bgp labeled-unicast rib ip tunnel
   router-id 112.112.112.112
   no bgp default ipv4-unicast
   bgp restart hitless disabled
   bgp cluster-id 112.112.112.112
   bgp transport pmtud
   maximum-paths 2 ecmp 2
   bgp listen range 2001:112:112:112::/64 peer-group 65001v6 remote-as 65001
   bgp bestpath tie-break router-id
   neighbor 64522v6 peer group
   neighbor 64522v6 remote-as 64522
   neighbor 64522v6 rib-in pre-policy retain all
   neighbor 64522v6 additional-paths send limit 2
   neighbor 64522v6 send-community extended large
   neighbor 65001 peer group
   neighbor 65001 remote-as 65001
   neighbor 65001 shutdown
   neighbor 65001 local-as 65001 no-prepend replace-as
   neighbor 65001 update-source Loopback0
   neighbor 65001 route-reflector-client
   neighbor 65001 additional-paths send any
   neighbor 65001 send-community extended
   neighbor 65001 maximum-routes 0
   neighbor 65001v6 peer group
   neighbor 65001v6 remote-as 65001
   neighbor 65001v6 local-as 65001 no-prepend replace-as
   neighbor 65001v6 update-source Loopback0
   neighbor 65001v6 route-reflector-client
   neighbor 65001v6 additional-paths send any
   neighbor 65001v6 send-community extended
   neighbor 65001v6 maximum-routes 0
   neighbor 65550 peer group
   neighbor 65550 remote-as 65550
   neighbor 65550 shutdown
   neighbor 65550 update-source Loopback0
   neighbor 65550 rib-in pre-policy retain all
   neighbor 65550 additional-paths send limit 2
   neighbor 65550 send-community extended large
   neighbor 65550 maximum-routes 0
   neighbor 65550v peer group
   neighbor 65550v6 peer group
   neighbor 65550v6 remote-as 65550
   neighbor 65550v6 next-hop-self
   neighbor 65550v6 update-source Loopback0
   neighbor 65550v6 rib-in pre-policy retain all
   neighbor 65550v6 additional-paths send limit 2
   neighbor 65550v6 send-community extended large
   neighbor 65550v6 maximum-routes 0
   neighbor 2001:3:3:3::3 peer group 64522v6
   neighbor 2001:111:111:111::111 peer group 65550v6
   neighbor 2001:113:113:113::113 peer group 65550v6
   neighbor 2001:113:113:113::113 shutdown
   !
   address-family evpn
      neighbor 65001v6 activate
      neighbor 65001v6 encapsulation vxlan 
      neighbor 65550v6 activate
      neighbor 65550v6 encapsulation mpls next-hop-self source-interface Loopback0
      neighbor default next-hop-self received-evpn-routes route-type ip-prefix
   !
   address-family ipv6
      neighbor 64522v6 activate
      neighbor 65550v6 activate
      redistribute connected
   !
   vrf evpn_1
      rd 112.112.112.112:10
      route-target import evpn 65000:10
      route-target import evpn 65001:10
      route-target export evpn 65001:10
      bgp additional-paths send any
      redistribute connected
      redistribute static
      redistribute attached-host
!
router traffic-engineering
   segment-routing
      binding-sid specified-only disabled
      binding-sid allocation dynamic
      !
      policy endpoint 2001:111:111:111::111 color 611
         path-group preference 5
            segment-list label-stack 900613 900611
   router-id ipv4 112.112.112.112
   router-id ipv6 2001:112:112:112::112
!
router isis igp
   net 47.0000.1121.1211.2112.00
   router-id ipv4 112.112.112.112
   is-type level-2
   max-lsp-lifetime 65535
   !
   address-family ipv6 unicast
      maximum-paths 2
      multi-topology
      fast-reroute ti-lfa mode link-protection
   !
   segment-routing mpls
      router-id 112.112.112.112
      no shutdown
   !
   traffic-engineering
      no shutdown
!
router multicast
   ipv4
      software-forwarding kernel
   !
   ipv6
      software-forwarding kernel
!
end
